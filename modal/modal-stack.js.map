{"version":3,"file":"modal-stack.js","sourceRoot":"","sources":["../../src/modal/modal-stack.ts"],"names":[],"mappings":"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","sourcesContent":["import {\r\n  ApplicationRef,\r\n  Injectable,\r\n  Injector,\r\n  ReflectiveInjector,\r\n  ComponentFactory,\r\n  ComponentFactoryResolver,\r\n  ComponentRef,\r\n  TemplateRef\r\n} from '@angular/core';\r\n\r\nimport {ContentRef} from '../util/popup';\r\nimport {isDefined, isString} from '../util/util';\r\n\r\nimport {NgbModalBackdrop} from './modal-backdrop';\r\nimport {NgbModalWindow} from './modal-window';\r\nimport {NgbActiveModal, NgbModalRef} from './modal-ref';\r\n\r\n@Injectable()\r\nexport class NgbModalStack {\r\n  private _backdropFactory: ComponentFactory<NgbModalBackdrop>;\r\n  private _windowFactory: ComponentFactory<NgbModalWindow>;\r\n\r\n  constructor(\r\n      private _applicationRef: ApplicationRef, private _injector: Injector,\r\n      private _componentFactoryResolver: ComponentFactoryResolver) {\r\n    this._backdropFactory = _componentFactoryResolver.resolveComponentFactory(NgbModalBackdrop);\r\n    this._windowFactory = _componentFactoryResolver.resolveComponentFactory(NgbModalWindow);\r\n  }\r\n\r\n  open(moduleCFR: ComponentFactoryResolver, contentInjector: Injector, content: any, options): NgbModalRef {\r\n    const containerSelector = options.container || 'body';\r\n    const containerEl = document.querySelector(containerSelector);\r\n\r\n    if (!containerEl) {\r\n      throw new Error(`The specified modal container \"${containerSelector}\" was not found in the DOM.`);\r\n    }\r\n\r\n    const activeModal = new NgbActiveModal();\r\n    const contentRef = this._getContentRef(moduleCFR, options.injector || contentInjector, content, activeModal);\r\n\r\n    let windowCmptRef: ComponentRef<NgbModalWindow>;\r\n    let backdropCmptRef: ComponentRef<NgbModalBackdrop>;\r\n    let ngbModalRef: NgbModalRef;\r\n\r\n\r\n    if (options.backdrop !== false) {\r\n      backdropCmptRef = this._backdropFactory.create(this._injector);\r\n      this._applicationRef.attachView(backdropCmptRef.hostView);\r\n      containerEl.appendChild(backdropCmptRef.location.nativeElement);\r\n    }\r\n    windowCmptRef = this._windowFactory.create(this._injector, contentRef.nodes);\r\n    this._applicationRef.attachView(windowCmptRef.hostView);\r\n    containerEl.appendChild(windowCmptRef.location.nativeElement);\r\n\r\n    ngbModalRef = new NgbModalRef(windowCmptRef, contentRef, backdropCmptRef, options.beforeDismiss);\r\n\r\n    activeModal.close = (result: any) => { ngbModalRef.close(result); };\r\n    activeModal.dismiss = (reason: any) => { ngbModalRef.dismiss(reason); };\r\n\r\n    this._applyWindowOptions(windowCmptRef.instance, options);\r\n\r\n    return ngbModalRef;\r\n  }\r\n\r\n  private _applyWindowOptions(windowInstance: NgbModalWindow, options: Object): void {\r\n    ['backdrop', 'keyboard', 'size', 'windowClass'].forEach((optionName: string) => {\r\n      if (isDefined(options[optionName])) {\r\n        windowInstance[optionName] = options[optionName];\r\n      }\r\n    });\r\n  }\r\n\r\n  private _getContentRef(\r\n      moduleCFR: ComponentFactoryResolver, contentInjector: Injector, content: any,\r\n      context: NgbActiveModal): ContentRef {\r\n    if (!content) {\r\n      return new ContentRef([]);\r\n    } else if (content instanceof TemplateRef) {\r\n      const viewRef = content.createEmbeddedView(context);\r\n      this._applicationRef.attachView(viewRef);\r\n      return new ContentRef([viewRef.rootNodes], viewRef);\r\n    } else if (isString(content)) {\r\n      return new ContentRef([[document.createTextNode(`${content}`)]]);\r\n    } else {\r\n      const contentCmptFactory = moduleCFR.resolveComponentFactory(content);\r\n      const modalContentInjector =\r\n          ReflectiveInjector.resolveAndCreate([{provide: NgbActiveModal, useValue: context}], contentInjector);\r\n      const componentRef = contentCmptFactory.create(modalContentInjector);\r\n      this._applicationRef.attachView(componentRef.hostView);\r\n      return new ContentRef([[componentRef.location.nativeElement]], componentRef.hostView, componentRef);\r\n    }\r\n  }\r\n}\r\n"]}